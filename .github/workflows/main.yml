name: get pull request info for Dingding

on:
  push:
  pull_request:

jobs:
  spring-boot:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
    - name: checkout
      uses: actions/checkout@v2
      
    # æ­¤å¤„çœç•¥å…·ä½“çš„ä¸šåŠ¡ä»£ç     
   
    # è·å–PRä¿¡æ¯å¹¶å°†å…¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡
    - name: set PR_INFO 
      run: |
        echo PR_NUMBER=$(echo $GITHUB_REF | awk 'BEGIN { FS = "/" } ; { print $3 }') >> $GITHUB_ENV
        echo PR_TITLE=$(jq --raw-output .pull_request.title "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
        echo PR_URL=$(jq --raw-output .pull_request.html_url "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
        echo PR_USER=$(jq --raw-output .pull_request.user.login "$GITHUB_EVENT_PATH") >> $GITHUB_ENV
    
    # æ‰“å°ç¯å¢ƒå˜é‡
    - name: print env
      run: printenv
     
    # å‘é€é’‰é’‰æ¶ˆæ¯
    - name: build success
      if: ${{ success() }}
      uses: fifsky/dingtalk-action@master
      with:
        url: https://oapi.dingtalk.com/robot/send?access_token=56ba2d0cc9211ae7cf36e94db961b5cea6fc288743781af7be86f5c7065cebf1
        type: markdown
        content: |
          # ğŸ’¯ğŸ‘¨â€ğŸ’» Success ğŸ‰ğŸ‰ğŸ‰
          > Maven Build of [# ${{ env.PR_TITLE }}](${{ env.PR_URL }}) by ${{ env.PR_USER }} success
          > ^_^ from github action message 
    - name: maven build failure
      if: ${{ failure() }}
      uses: fifsky/dingtalk-action@master
      with:
        url: https://oapi.dingtalk.com/robot/send?access_token=56ba2d0cc9211ae7cf36e94db961b5cea6fc288743781af7be86f5c7065cebf1
        type: markdown
        content: |
          # ğŸ’¤ğŸ¤·â€â™€ï¸ failure ğŸ™…â€â™‚ï¸ğŸ’£
          > Maven Build of [# ${{ env.PR_TITLE }}](${{ env.PR_URL }}) by ${{ env.PR_USER }} failure
          > (â‹Ÿï¹â‹)   from github action message
